#include "ysJob.h"

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void ysJob::Reset()
{
    m_fcn = nullptr;
    m_fcnArg = nullptr;
    m_parent = nullptr;
    m_unfinishedJobCount = 0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void ysJob::Create(void(*fcn)(void*), void* fcnArg, ysJob* parent)
{
    m_fcn = fcn;
    m_fcnArg = fcnArg;
    m_parent = parent;
    m_unfinishedJobCount = 1;
    if (parent != nullptr)
    {
        parent->m_unfinishedJobCount++;
    }
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void ysJob::Execute()
{
    m_fcn(m_fcnArg);
    __Finish();
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
bool ysJob::IsFinished() const
{
    return (m_unfinishedJobCount == 0);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void ysJob::__Finish()
{
    m_unfinishedJobCount--;
    if (m_unfinishedJobCount == 0 && m_parent != nullptr)
    {
        m_parent->__Finish();
    }
}